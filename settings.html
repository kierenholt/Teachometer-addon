<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
  <style>

      #studentNamesTextarea {white-space: nowrap;  overflow: auto;}
      
div#createWebsiteForm {
  background-color: lightgrey;
}
div#updateWebsiteForm {
  background-color: lightblue;
}
  </style>
    
  </head>
  <body>
    

    
    <h1>When I click Print</h1>
    <?!= settingToHTMLElement(getSettings(["print-show-solutions","print-jumbled-solutions","print-show-titles","print-every-question-new-page"],false)) ?>

    
    <h1>Markbook</h1>
    <p>When a new quiz is created, a new marksheet for that quiz will be automatically generated and added to...</p> 
    <a id="markbookUrlLink" href="<?= markbookUrl ?>" target="_blank">
      <p>Google workbook <span  id="markbookNameSpan"><?= markbookName ?></span></p>
    </a>
    <!---
    <button class="blue" onClick='generateMarkbook();'>Generate a new markbook</button> 
    <img id="loadingGif" src="https://i.imgur.com/ErfEUeJ.gif" style="height:32px;display:none"/>
    <span style="color:red" id="generateMarkbookErrorMessage"></span>
    --->
    
    <h1>Marksheet score columns</h1>
    <p>These are score columns that will be used in the marking sheet when the quiz is first made. More columns can also be created after the quiz is made.<br>
    <?!= settingToHTMLElement(getSettings(["correct-%-enabled","attempted-%-enabled","stars-%-enabled",
          "correct-enabled","attempted-enabled","stars-enabled","outof-enabled"],false)) ?>
    <br>
    </p>
    
    <h1>Marksheet default settings</h1>
    <p>These are the default settings to be used when a quiz is first made. They can also be changed after the quiz is made.<br>
    <?!= settingToHTMLElement(getSettings(["shuffle-default","viewers-default","journal-mode-default",
    "append-default","remove-hyperlinks-default","mark-limit-default","checks-limit-default","time-limit-default"],false)) ?>
    </p>    
    
    <h1>Students</h1>
    <p>These names are automatically added to the markbook. Students must enter these names when they visit the lesson website for the first time. More names can be added once the quiz has been made. </p> 
    <textarea rows=30 cols=12 id="studentNamesTextarea"><?= studentNames ?></textarea>
    <button class="blue" onClick='saveStudents();'>Save</button>
    <span style="color:red" id="saveStudentsErrorMessage"></span>
    <span style="color:green" id="saveStudentsConfirmation" hidden>Setting Saved</span>
        
  
    
    <h1>Reset All</h1>
    <button class="blue" onClick='resetAllSettings();'>Click to wipe all settings</button>
  
<script>


function resetAllSettings() {
      google.script.run
            .withSuccessHandler(
              function(rowObject, element) { 
                google.script.host.close();
                }
              ).resetAllSettings();
}

function saveSetting(inputElement) {
    var toSave = {};
  if (inputElement.type == "checkbox") { //ONLY DETECTS CHECKED AFTER THE FUNCTION HAS RUN
    toSave[inputElement.name] = inputElement.checked; 
  }
  if (inputElement.type == "text") { //ONLY DETECTS CHECKED AFTER THE FUNCTION HAS RUN
    toSave[inputElement.name] = inputElement.value; 
  }
  if (inputElement.tagName == "SELECT") {
    toSave[inputElement.name] = inputElement.value; 
  }
  
    google.script.run
      .withSuccessHandler(
        function(success, element) {
            var successPara = document.createElement("span");
            successPara.innerText = "setting saved";
            successPara.style = "color: green";
            inputElement.parentElement.insertBefore(successPara,inputElement.nextSibling);
            setTimeout(function(paramE) {var e = paramE; return function() {e.parentElement.removeChild(e)} }(successPara), 3000);
          }
        ).saveSettings(toSave);
}

function saveStudents() {
  google.script.run
        .withSuccessHandler(
          function(students, element) {
              document.getElementById("saveStudentsConfirmation").hidden = false;
              document.getElementById("saveStudentsErrorMessage").innerHTML = "";
          }
          ).withFailureHandler(
            function(error) {
              document.getElementById("saveStudentsErrorMessage").innerHTML = error;
            }
          ).saveStudents(document.getElementById("studentNamesTextarea").value);
}
    
/*
function generateMarkbook() {
  document.getElementById("loadingGif").style.display = "inline";
  google.script.run
        .withSuccessHandler(
          function(ret, element) {
            //alert(JSON.stringify(ret));
            document.getElementById("loadingGif").style.display = "none";
            document.getElementById("markbookUrlLink").href= ret["markbookUrl"];
            document.getElementById("markbookNameSpan").innerHTML = ret["markbookName"];
          }
          ).withFailureHandler(
            function(error) {
              //alert(JSON.stringify(error));
              document.getElementById("generateMarkbookErrorMessage").innerHTML = error;
              document.getElementById("loadingGif").style.display = "none";
            }
          ).generateMarkbook();
}
*/

</script>

  </body>
  
  
</html>


